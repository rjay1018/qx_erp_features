<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Inherit Delivery Slip Report -->
    <template id="report_deliveryslip_inherit_customer_barcode" inherit_id="stock.report_deliveryslip">
        <xpath expr="//td[@name='barcode']" position="replace">
            <td name="barcode">
                <!-- Try to get the customer-specific barcode -->
                <t t-set="customer_barcode"
                   t-value="line.product_id.product_tmpl_id.customer_barcode_ids.filtered(lambda b: b.partner_id.id == o.partner_id.id)[:1].barcode"/>
                
                <t t-if="customer_barcode">
                    <span>
                        <t t-esc="customer_barcode"/>
                    </span>
                </t>
                <t t-else="">
                    <!-- fallback to product barcode -->
                    <span>
                        <t t-esc="line.product_id.barcode"/>
                    </span>
                </t>
            </td>
        </xpath>
    </template>
</odoo>
